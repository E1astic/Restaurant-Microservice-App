# Микросервисное приложение "Ресторан"

#### Приложение имитирует работу ресторана. В нем реализованы сервисы официантов и кухни и их взаимодействие.

---

### В проекте используются:

- Java 21
- Spring Boot 3.4.3
- Spring Data JPA
- Lombok
- MapStruct
- PostgreSQL
- Liquibase
- Hibernate
- MyBatis
- Kafka
- FeignClient
- Логирование
- Swagger
- Тесты (unit, интеграционные, поднятие контекста)
- Testcontainers
- Javadoc
- Postman
---

## Инструкция по запуску приложения:

1. Запустить `docker-compose.yaml` в корневом модуле **restaurant**.
   С помощью него запустятся контейнеры с **zookeeper**, **kafka**, **kafka-ui** и прочими утилитами для kafka


2. Запустить файлы `docker-compose.yaml` в модулях **waiter-service** и **kitchen-service**.
   С помощью них запустятся контейнеры с базами данных каждого микросервиса


3. Запустить классы `WaiterServiceApplication` и `KitchenServiceApplication`.
   При их старте автоматически выполнятся liquibase-миграции по созданию баз данных
   и заполнению таблиц данными, если эти миграции еще не выполнены


4. Для выполнения запросов импортировать в Postman коллекции `Waiter-service Restaurant LIGA.postman_collection.json`
   и `Kitchen-service Restaurant LIGA.postman_collection.json`, а также окружение с переменными
   `Restaurant LIGA ENV.postman_environment.json`. Эти файлых находятся в папке resources модулей
   **waiter-service**, **kitchen-service** и корневого модуля **restaurant**
---

### Модуль официантов:

- Принимает заказы от пользователей
- Асинхронно отправляет заказы на кухню через Kafka
- Уведомляет пользователей о текущем статусе заказа

### Модуль кухни:

- Получает заказы от официантов
- Принимает решение о принятии или отклонении заказа, готовит заказ
- Уведомляет официантов о смене статуса заказа

Также есть общий модуль **common**, который содержит общие компоненты для микросервисов кухни и официантов.

Модуль **dependency-bom** содержит **pom.xml** для управления версиями всех зависимостей и плагинов,
а также содержит общие зависимости.

---

## Описание ключевых шагов работы приложения:

1. Пользователь отправляет заказ официанту, в котором указаны:
    - ID официанта
    - Номер (название) столика
    - Структура формата "ключ-значение" из ID блюда и его количества в заказе


2. Официант проверяет полученный заказ на корректность:
    - Проверяет существование официанта с переданным ID
    - Проверяет существование в меню блюд с переданными ID


3.
    - В случае невыполнения условий пункта 2 выбрасывается исключение о соответствующей ошибке.
    - В случае корректных данных официант оформляет заказ, статус официанта устанавливается в **ACCEPTED** (принят),
      и затем официант перенаправляет заказ на кухню.


4. Кухня получает заказ, устанавливает ему статус **RECEIVED** (получен) и сохраняет в базу.


5. Кухня выполняет проверку, достаточно ли блюд на складе для выполнения данного заказа.
    - Если хотя бы одного блюда недостаточно, заказу устанавливается статус **REJECTED** (отменен), и кухня
      уведомляет официантов о смене статуса заказа. У официантов статус тоже меняется на **REJECTED** (отменен).
    - Если всех блюд достаточно, заказу устанавливается статус **PREPARING** (готовится), а в базе
      обновляется количество оставшихся блюд. Пока заказ готовится, статус официанта остается **ACCEPTED** (принят).


6. Кухня имеет возможность в любой момент отменить заказ по какой-либо причине.
   Официанты будут уведомлены об этом.


7. Когда заказ будет готов, кухня устанавливает ему статус **READY** (готов) и уведомляет об этом
   официантов, у которых статус также изменится на **READY** (готов).

---

#### На любом этапе жизненного цикла заказа есть возможность получить список всех заказов официантов и кухни.
#### Есть возможность узнать только текущий статус заказа у официанта без получения дополнительной информации.

